  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Federation Sun 2025</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet" />
<style>
:root { --ticker-distance: 0px; --ticker-duration: 20s; }

html, body {
  margin: 0;
  font-family: 'Bebas Neue', sans-serif;
  background: #1e1e1e;
  color: white;
  box-sizing: border-box;
  overflow-x: hidden;
}

body {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 0;
}

img { max-width: 100%; height: auto; display: block; }

.banner {
  position: fixed;
  top: 0; left: 0; right: 0;
  background: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0,0,0,0.4);
  z-index: 1000;
}

.banner-content {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  grid-template-areas: "social logo search";
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
  padding: 12px 0;
  column-gap: 8px;
}

/* (Other general styles remain unchanged...) */

.ticker-inner:hover .ticker-track {
  animation-play-state: paused;
}

/* Poll Container Styles */
#poll-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  background: #222;
  border: 1px solid #444;
  padding: 16px;
  margin-bottom: 20px;
  border-radius: 4px;
}

#poll-container h3 {
  margin: 0 0 12px 0;
  font-size: 18px;
  color: gold;
  text-shadow: none !important;
}

#poll-container label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin: 4px 0;
  justify-content: center;
  cursor: pointer;
  color: white;
}

#poll-container form {
  display: flex;
  flex-direction: column;
  align-items: center;
}

#poll-container p {
  color: white;
  text-shadow: none !important;
}

#poll-container .poll-thank-you {
  color: white;
  text-shadow: none !important;
}

#poll-container .poll-thank-you b {
  color: white;
}

/* Button Flag */
.button-flag {
  background-image: url('australian_flag.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  border: 1px solid white;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 32px;
  padding: 0 12px;
  box-sizing: border-box;
  color: white;
  font-size: 15px;
  font-weight: bold;
  margin-top: 12px;
  text-shadow: none !important;
}

/* Make sure all h3 and p in poll have no shadow */
#poll-container h3,
#poll-container p,
#poll-container .poll-thank-you {
  text-shadow: none !important;
}
</style>

</head>
<body>

  <div class="banner">
    <div class="banner-content">
      <div class="social-section">
        <div class="time-subsection">
          <div id="current-time">--:-- AEST</div>
          <div id="current-date">--/--/----</div>
        </div>
        <div class="icons-subsection">
          <a href="https://gab.com/federationsun" target="_blank"><img src="icon_gab.png" alt="Gab"></a>
          <a href="https://www.facebook.com/people/Federation-Sun/61577319796033/" target="_blank"><img src="icon_facebook.png" alt="Facebook"></a>
          <a href="https://www.instagram.com/fedsun.news/" target="_blank"><img src="icon_instagram.png" alt="Instagram"></a>
          <a href="https://t.me/federationsun" target="_blank"><img src="icon_telegram.png" alt="Telegram"></a>
          <a href="https://x.com/federationsun" target="_blank"><img src="icon_x.png" alt="X"></a>
          <a href="https://www.youtube.com/channel/UCe8DBHr28mOCBxtZuxzJ7_A" target="_blank"><img src="icon_youtube.png" alt="YouTube"></a>
        </div>
      </div>
      <div class="left-section">
        <img src="fedsun_logo_hoz.png" alt="Logo" class="logo">
      </div>
      <div class="center-section">
        <form id="search-form" action="https://www.google.com/search" method="GET" target="_blank" autocomplete="off">
          <input type="text" id="search-input" name="q" placeholder="Search...">
          <button type="submit">Search</button>
        </form>
      </div>
    </div>
    <div class="ticker">
      <div class="ticker-inner" id="ticker-inner">
        <div class="ticker-track" id="ticker-track">Loading headlines…</div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="main-headline-layout">
      <div class="main-headline-left">
        <div class="main-headline-img-wrapper">
          <img src="1st.jpg" alt="Main Headline" class="main-headline-img" />
        </div>
        <a href="#" class="main-headline-link">WEBSITE UNDER CONSTRUCTION</a>
        <div class="two-columns-below">
          <div class="column" id="latest-headlines"></div>
          <div class="column" id="more-headlines">
  <div id="poll-container" class="headline-item"></div>
  <div id="more-headlines-list"></div>
</div>

        </div>
      </div>
      <div class="right-column" id="right-column-1"></div>
    </div>
  </div>

  <hr class="footer-separator" />

  <footer>
    <div class="footer-wrapper">
      <div class="footer-content">
        <div class="footer-section left">
          <img src="australian_flag.png" alt="Australian Flag" />
          <p>
            The Federation Sun proudly honours the European Australians who built this nation—taming the land, founding our cities, and instilling the traditions and institutions of Western civilisation that shaped Australia. We stand firm in our heritage and look ahead with unity and purpose to secure a strong future for our people.
          </p>
        </div>
        <div class="footer-section center">
          <img src="fedsun__logo_footer.png" alt="Federation Sun Logo" />
          <p>
            Contact:<br />
            <a href="mailto:editor@fedsun.news" style="color:white;">editor@fedsun.news</a>
          </p>
          <p>The Federation Sun © 2025</p>
        </div>
        <div class="footer-section right">
          <h3>ANONYMOUS TIPS</h3>
          <form action="https://formspree.io/f/meokpdkj" method="POST">
            <textarea name="tip" placeholder="Type your tip here..."></textarea>
            <input type="hidden" name="_redirect" value="https://fedsun.news/thanks.html" />
            <button type="submit">Send tip</button>
          </form>
        </div>
      </div>
    </div>
  </footer>

  <script>
    function updateTime() {
      const now = new Date();
      const t = new Intl.DateTimeFormat('en-AU', {
        timeZone: 'Australia/Melbourne',
        hour: '2-digit', minute: '2-digit', hour12: false
      }).format(now);
      const d = new Intl.DateTimeFormat('en-AU', {
        timeZone: 'Australia/Melbourne',
        weekday: 'short', year: 'numeric', month: '2-digit', day: '2-digit'
      }).format(now);
      document.getElementById('current-time').textContent = t + ' AEST';
      document.getElementById('current-date').textContent = d;
    }
    updateTime();
    setInterval(updateTime, 60000);

    fetch('/data/main-headline.json?' + new Date().getTime())
      .then(r => r.json())
      .then(data => {
        document.querySelector('.main-headline-img').src = data.image;
        document.querySelector('.main-headline-link').textContent = data.title;
        document.querySelector('.main-headline-link').href = data.url;
      });

    fetch('/data/headlines.json?' + new Date().getTime())
      .then(r => r.json())
      .then(data => {
        const today = new Date();
        const recent = data.filter(item => {
          const d = new Date(item.date);
          const diff = (today - d) / (1000 * 60 * 60 * 24);
          return diff <= 7;
        });
       
        const track = document.getElementById('ticker-track');
        track.innerHTML = '';
        const grp = document.createElement('div');
        grp.className = 'ticker-group';
        recent.forEach(item => {
          const a = document.createElement('a');
          a.href = item.url;
          a.textContent = item.title;
          grp.appendChild(a);
        });
        track.appendChild(grp);
        track.appendChild(grp.cloneNode(true));
        const dist = grp.offsetWidth, speed = 20;
        document.documentElement.style.setProperty('--ticker-distance', dist + 'px');
        document.documentElement.style.setProperty('--ticker-duration', (dist / speed) + 's');

        const col1 = document.getElementById('latest-headlines');
        const col2 = document.getElementById('more-headlines');
        const col3 = document.getElementById('right-column-1');
        col1.innerHTML = '';
document.getElementById('more-headlines-list').innerHTML = '';
col3.innerHTML = '';
        // Split headlines manually
const col1Headlines = recent.slice(0, 6);               // First 6 go to column 1
const col2Headlines = recent.slice(6, 9);               // Next 3 go to column 2
const col3Headlines = recent.slice(9);                  // The rest go to column 3

// Column 1
col1.innerHTML = '';
col1Headlines.forEach(item => {
  const wrapper = document.createElement('div');
  wrapper.className = 'headline-item';

  const img = document.createElement('img');
  img.src = item.image;
  img.alt = item.title;
  img.style.width = '33%';
  img.style.aspectRatio = '16/9';
  img.style.objectFit = 'cover';

  const a = document.createElement('a');
  a.href = item.url;
  a.textContent = item.title;
  a.style.flex = '1';
  a.style.textAlign = 'left';
  a.style.color = 'white';

  wrapper.appendChild(img);
  wrapper.appendChild(a);
  col1.appendChild(wrapper);
});

// Column 2
document.getElementById('more-headlines-list').innerHTML = '';
col2Headlines.forEach(item => {
  const wrapper = document.createElement('div');
  wrapper.className = 'headline-item';

  const img = document.createElement('img');
  img.src = item.image;
  img.alt = item.title;
  img.style.width = '33%';
  img.style.aspectRatio = '16/9';
  img.style.objectFit = 'cover';

  const a = document.createElement('a');
  a.href = item.url;
  a.textContent = item.title;
  a.style.flex = '1';
  a.style.textAlign = 'left';
  a.style.color = 'white';

  wrapper.appendChild(img);
  wrapper.appendChild(a);
  document.getElementById('more-headlines-list').appendChild(wrapper);
});

// Column 3
col3.innerHTML = '';
col3Headlines.forEach(item => {
  const wrapper = document.createElement('div');
  wrapper.className = 'headline-item';

  const img = document.createElement('img');
  img.src = item.image;
  img.alt = item.title;
  img.style.width = '33%';
  img.style.aspectRatio = '16/9';
  img.style.objectFit = 'cover';

  const a = document.createElement('a');
  a.href = item.url;
  a.textContent = item.title;
  a.style.flex = '1';
  a.style.textAlign = 'left';
  a.style.color = 'white';

  wrapper.appendChild(img);
  wrapper.appendChild(a);
  col3.appendChild(wrapper);
});


  


        })

    .catch(e => console.error('Fetch error loading headlines:', e));
    
  </script>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
      window.netlifyIdentity.init();
    }
  </script>

 <!-- 1️⃣ Load the Supabase library FIRST -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- 2️⃣ Initialize Supabase -->
<script>
  const supabaseUrl = 'https://fpsykizmderxiwovqcwk.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZwc3lraXptZGVyeGl3b3ZxY3drIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0OTUyMDksImV4cCI6MjA2NzA3MTIwOX0.GkLxj8sTj9uK_6taRK0HH2b_FobLRUa3UhxfgN7QssA';
  const { createClient } = supabase;
const supabaseClient = createClient(supabaseUrl, supabaseKey);

</script>

<!-- 3️⃣ Your vote form script -->
<script>
fetch('/data/poll.json?' + new Date().getTime())
  .then(r => r.json())
  .then(poll => {
    const container = document.getElementById('poll-container');
    if (!container) return;
    if (!poll || !poll.question || !poll.options) return;

    // Build the poll form
    let html = `<form id="poll-form"><h3 class="poll-title">${poll.question}</h3>`;

    poll.options.forEach(opt => {
      html += `<label><input type="radio" name="pollOption" value="${opt}"> ${opt}</label>`;
    });
    html += `<button type="submit" class="button-flag">Vote</button></form>`;

    container.innerHTML = html;

    const form = document.getElementById('poll-form');
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const selected = form.elements['pollOption'].value;

      // Save the vote
      const { error } = await supabaseClient
        .from('poll_votes')
        .insert([{ option: selected }]);

      if (error) {
        container.innerHTML = `<p style="color:red;">Error saving vote: ${error.message}</p>`;
      } else {
        // Show results
        loadVoteCounts(selected);
      }
    });
  })
  .catch(e => console.error('Fetch error:', e));

async function loadVoteCounts(votedOption) {
  const container = document.getElementById('poll-container');
  container.innerHTML = `<p class="poll-thank-you">Thank you for voting${votedOption ? ' for <b>' + votedOption + '</b>' : ''}!</p><p>Loading results...</p>`;


  const { data, error } = await supabaseClient
    .from('poll_votes')
    .select('option');

  if (error) {
    container.innerHTML = `<p style="color:red;">Error loading results: ${error.message}</p>`;
    return;
  }

  // Count votes
  const counts = {};
  data.forEach(row => {
    counts[row.option] = (counts[row.option] || 0) + 1;
  });

  // Calculate total votes
  const totalVotes = Object.values(counts).reduce((a, b) => a + b, 0);

  // Build results HTML
  let resultsHtml = '<h3>Vote Results</h3><div style="width:100%;text-align:left;">';
  Object.entries(counts).forEach(([opt, count]) => {
    const percent = ((count / totalVotes) * 100).toFixed(1);
    resultsHtml += `
      <div style="margin-bottom:8px;">
        <div style="margin-bottom:4px;">${opt}: ${count} vote${count!==1?'s':''} (${percent}%)</div>
        <div style="background:#555;width:100%;height:14px;border-radius:4px;overflow:hidden;">
          <div style="background:gold;width:${percent}%;height:100%;"></div>
        </div>
      </div>`;
  });
  resultsHtml += '</div>';

  container.innerHTML = `<p class="poll-thank-you">Thank you for voting${votedOption ? ' for <b>' + votedOption + '</b>' : ''}!</p>` + resultsHtml;

}
</script>




  
</body>
</html>
